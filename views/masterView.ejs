<!DOCTYPE html>
<html lang="en">
<head>

    <!-- SITE TITTLE -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>One Study - 스터디 매칭 서비스</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">

    <!-- Include Editor style. -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.5.1/css/froala_editor.pkgd.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.5.1/css/froala_style.min.css" rel="stylesheet" type="text/css" />

    <!-- Include jQuery lib. -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

    <!-- Include Editor JS files. -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.5.1//js/froala_editor.pkgd.min.js"></script>

    <!-- PLUGINS CSS STYLE -->
    <link href="plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet">
    <!-- Bootstrap -->
    <link href="plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- Select 2 -->
    <link href="plugins/selectbox/select_option1.css" rel="stylesheet">
    <!-- Owl Carousel -->
    <link href="plugins/owl-carousel/assets/owl.carousel.min.css" rel="stylesheet" media="screen">
    <!-- Owl Carousel Theme -->
    <link href="plugins/owl-carousel/assets/owl.theme.green.min.css" rel="stylesheet" media="screen">
    <!-- Fancy Box -->
    <link href="plugins/fancybox/jquery.fancybox.pack.css" rel="stylesheet">
    <!-- Datepicker -->
    <link href="plugins/datepicker/datepicker.min.css" rel="stylesheet">

    <!-- CUSTOM CSS -->
    <link href="css/board.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/login.css" rel="stylesheet">

    <!-- FAVICON -->
    <link href="img/favicon.png" rel="shortcut icon">
    <!-- googlefont -->
    <link href="https://fonts.googleapis.com/css?family=Black+Han+Sans|Do+Hyeon|Gamja+Flower|Gothic+A1:400,700|Nanum+Brush+Script|Nanum+Gothic:400,700,800|Nanum+Myeongjo:400,700,800|Nanum+Pen+Script|Poor+Story|Song+Myung|Sunflower:300,500,700&amp;subset=korean" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body class="body-wrapper">

<!--=====================================
=            Top Header Menu            =
======================================-->
<%- include topHeader.ejs %>
<!--=============================
=            Nav Bar            =
==============================-->
<%- include topButton.ejs %>

<!--==================================
=            Write contents            =
===================================-->

<section class="store-coupon section">
    <!-- Container Start -->
    <div class="container">
        <div class="row">
            <div class="col-md-10 col-lg-11" style="margin:auto;">
                <!-- Block -->
                <div class="block">
                    <div class="media">
                        <!-- Store Icon -->
                        <div class="row" style="width:100%;">
                        <div class="col-sm-5 col-md-5 col-lg-2 image-content d-flex align-self-center" style="height:120px;">
                          <img src="<%- board.masterphoto %>" style="margin:auto;display:block;width:100%;height:100% ;border-radius:50%;"  alt="master_profile">
                        </div>
                        <div class="col-sm-7 col-md-7 col-lg-7 media-body" style="margin:10px 20px;">
                            <!-- <form action="/process/addboard" method="post"> -->
                            <!-- Heading -->
                            <span class="headerSign"><%=board.title %></span>
                            <!-- Description -->
                            <div class="row">
                              <div class="col-lg-6 form-group">
                                <label class="darktext">지역</label>
                                <span style=""><%= board.regionShort %></span>
                              </div>
                              <div class="col-lg-6 form-group">
                                <label class="darktext">카테고리</label>
                                <% for(var i=0; i < board.category.length;i++){ %>
                                <span style=""><%= board.category[i] %></span>
                                <% } %>
                              </div>
                              <div class="col-lg-6 form-group">
                                <label class="darktext">모집기한</label>
                                <span id="deadline"></span>
                                <script>
                                  var i = new Date('<%- board.deadline %>');
                                  document.getElementById('deadline').innerHTML = date_format(i);
                                  function date_format(dateValue){
                                    var dd = dateValue.getDate();
                                    var mm = dateValue.getMonth()+1;
                                    var yyyy = dateValue.getFullYear();

                                    if(dd<10){
                                      dd = '0'+dd;
                                    }
                                    if(mm<10){
                                      mm = '0'+mm;
                                    }
                                    return yyyy+'-'+mm+'-'+dd;
                                  }
                                </script>
                              </div>
                              <div class="col-lg-6 form-group">
                                <label class="darktext">모집인원</label>
                                  <label class="control-label" style="font-size: 14px;" for="minNum">최소</label>
                                  <span>&nbsp;<%=board.minNum%>명</span>
                                  <label class="control-label" style="font-size: 14px;" for="maxNum">최대</label>
                                  <span>&nbsp;<%=board.maxNum%>명</span>
                                  <!-- <label class="control-labe" style="font-size: 14px;" for="currentNum">현재</label>
                                  <span>&nbsp;<%=board.currentNum%>명</span> -->
                              </div>
                              <div class="col-lg-6 form-group">
                                <label for="studyTerm" class="darktext">스터디 기간</label>
                                <span>&nbsp;<%=board.studyTerm%>주</span>
                              </div>
                              <div class="col-lg-6 form-group">
                                <label for="price" class="darktext">수업료<small style="color:gray;">(총)</small></label>
                                <span style="font-size:22px;font-weight: 700;color:#ff751a;">&nbsp;주 <%=board.studynum%>회 <%=board.price%>만원</span>
                              </div>
                            </div>
                        </div>
                        <div class="col-md-12 col-lg-2">
                            <!--핸드폰 인증 기능 개발되면 !authPhone을 authPhone으로 바꿔 인증된 사람만 할 수 있게 수정해야함 !!-->
                            <%if(!authUser.phoneAuthCheck){%>
                            <button type="button" class="btn btn-transparent" data-toggle="modal" data-target="#login" style="width:100%;">참여 신청하기</button>
                            <%} else {%>
                            <a href="/studentapply" style="width:100%;" class="btn btn-transparent">참여 신청하기</a>
                            <%}%>
                        </div>
                        </div>
                    </div>

                    <article style="margin:0;padding:10px;">
                        <div class="post-slider owl-carousel owl-theme" style="width: 100%;">
                            <div class="item"><a href="single-blog.html"><img src="<%=board.path%>" style ="width: 100%;height: 250px;" alt="Slider-Img-01"></a></div>
                            <div class="item"><a href="single-blog.html"><img src="img/blog/post-2.jpg" style="width: 100%;height: 250px;" alt="Slider-Img-02"></a></div>
                            <div class="item"><a href="single-blog.html"><img src="img/blog/post-2.jpg" style="width: 100%;height: 250px;" alt="Slider-Img-03"></a></div>
                        </div>
                    </article>
                </div>
                <div style="margin-top:50px;">
                  <div class="editor_cnt">
                    <div class="col-lg-2 title">
                        <h5>Master 소개</h5>
                    </div>
                    <div class="col-lg-10 block">
                      <%- board.masterInfo %>
                    </div>
                  </div>
                  <div class="editor_cnt">
                    <div class="col-lg-2 title">
                        <h5>Study 소개</h5>
                    </div>
                    <div class="col-lg-10 block">
                      <%- board.studyInfo %>
                    </div>
                  </div>
                  <div class="editor_cnt">
                    <div class="col-lg-2 title">
                        <h5>스터디 장소</h5>
                    </div>
                    <div id="gMap" class="col-lg-10 block" style="height:350px;"></div>
                  </div>
                  <div class="editor_cnt">
                    <div class="col-lg-2 title">
                        <h6>마스터에 대한 후기</h6>
                    </div>
                    <div class="col-lg-10 block" style="padding: 25px 0px 30px 0">
                      <div class="review_star">
                        <span>스터디평점</span>
                        <span><%= board.reviewstar+'.0' %></span>
                        <span>
                          <% var temp=0;var s; for(s=0;s< board.reviewstar;s++){ %>
                          <i class="fas fa-star" style="color:#ff751a;"></i><% } %>
                          <% for(s;s< 5;s++){%><i class="fas fa-star" style="color:#e6e6e6;"></i><%}%></span>
                      </div>
                      <form id="replyAction" action="/process/comment" method="post">
                        <% if(board.comments.length>0){ var commentsList = board.comments;%>
                          <% for (var i =0;i< commentsList.length;i++){ %>
                      <div class="row comment" style="width:100%;">
                        <div class="col-lg-2 commentimg">
                          <img src="<%- authUser.photo %>" style="height: 55px;width:55px;margin:auto;display: block;border-radius:50%;" alt="">
                        </div>
                        <div class="col-lg-10 commentcnt">
                          <table>
                            <tr>
                              <td><%=commentsList[i].author%></td>
                              <td id="comment_date[<%=i%>]" style="font-size:13px;"></td>
                              <script>
                              var i = new Date('<%- commentsList[i].comment_date %>');
                              document.getElementById('comment_date[<%=i%>]').innerHTML = date_format2(i);
                                function date_format2(dateValue){
                                  var dd = dateValue.getDate();
                                  var mm = dateValue.getMonth()+1;
                                  var yyyy = dateValue.getFullYear();
                                  var hh = dateValue.getHours();
                                  var mimi = dateValue.getMinutes();
                                  if(dd<10){
                                    dd = '0'+dd;
                                  }
                                  if(mm<10){
                                    mm = '0'+mm;
                                  }
                                  if(hh<10){
                                    hh = '0'+hh;
                                  }
                                  if(mimi<10){
                                    mimi = '0'+mimi;
                                  }
                                  return yyyy+'.'+mm+'.'+dd+' - '+hh+':'+mimi;
                                }
                              </script>
                              <td>
                                <% var a; for(a=0;a< commentsList[i].star_rating;a++){ %>
                                <i class="fas fa-star" style="color:#ff751a;">
                                <%} for(a;a< 5; a++){ %>
                                <i class="fas fa-star" style="color:#e6e6e6;">
                                  <% } temp=temp+commentsList[i].star_rating;%>
                              </td>
                            </tr>
                            <tr>
                              <td colspan="3" style="font-size:18px;color:gray;"><%=commentsList[i].contents%></td>
                            </tr>
                          </table>
                        </div>
                      </div>
                      <%}}%>
                      <div class="rating-stars" style="background-color:#e6e6e6;margin:20px;padding:25px;text-align:center;">
                        <ul id='stars'>
                          <li class='star' title='Poor' data-value='1'>
                            <i class="fas fa-star"></i>
                          </li>
                          <li class='star' title='Fair' data-value='2'>
                            <i class="fas fa-star"></i>
                          </li>
                          <li class='star' title='Good' data-value='3'>
                            <i class="fas fa-star"></i>
                          </li>
                          <li class='star' title='Excellent' data-value='4'>
                            <i class="fas fa-star"></i>
                          </li>
                          <li class='star' title='Perfect' data-value='5'>
                            <i class="fas fa-star"></i>
                          </li>
                        </ul>
                        <div id="rating_point" value="0.0">0.0</div>
                        <input type="hidden" id="hidden_point" name="star_rating" value="">
                        <input type="hidden" id="reviewstar" name="reviewstar" value="">
                      </div>
                      <div class="comment_write" style="margin:20px;">
                        <input type="hidden" name="replyId" id="replyId" value="<%=board._id%>">
                        <textarea name="contents" class="form-control" rows="2"
                                  style="display: inline;width:80%;float:left;" placeholder="감사합니다."  /required></textarea>
                        <button type="submit" name="button" class="btn" style="background-color:#ff751a;color:#fff;float:left;width:15%;height:78px;">전송</button>
                      </div>
                      </form>
                    </div>
                  </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Container End -->
</section>

<div class="modal fade" role="dialog" id="login" style="top: 10%;">
    <div class="modal-dialog signup-content" >
            <br><br>
        <form action="/process/participateStudy?id=<%=board._id%>" method="post" class="form-horizontal">
            <div class="form-group" style="margin:auto;">
                <div class="real_content">
                    <h2 style="text-align: center;">간단한 자기소개</h2>
                    <p style="text-align:center; color:gray;">마스터에게 하고 싶은 말을 써주세요.</p>
                    <div class="login-set">
                        <textarea name="selfIntroduction" rows="8" id="" style="width: 100%;"></textarea>
                    </div>
                    <div class="login-set">
                        <button type="submit" class="form-control btn btn-warning" id="sign-in">스터디 참여하기</button>
                    </div>
                </div>
            </div>
        </form>
        <br><br>
    </div>
</div>

<!--============================
=            Footer            =
=============================-->
<%- include footer.ejs %>

<!-- Include jQuery lib. -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

<!-- Include Editor JS files. -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.5.1//js/froala_editor.pkgd.min.js"></script>

<!-- JAVASCRIPTS -->

<script type="text/javascript">
    var x=<%-board.location.coordinates[1]%>;
    var y=<%-board.location.coordinates[0]%>;
    function myMap() {
        var mapCanvas = document.getElementById("gMap");
        var myCenter = new google.maps.LatLng(x,y);
        var marker = new google.maps.Marker({position:myCenter});
        var mapOptions = {
            center: myCenter,
            zoom: 14
        };
        var map = new google.maps.Map(mapCanvas, mapOptions);
        marker.setMap(map);

        google.maps.event.addListener(marker,'click',function() {
            map.setZoom(17);
            map.setCenter(marker.getPosition());
        });
    }

    $(function(){
      $('.text').froalaEditor({
        key: 'bA2A8B8D7cD3F3C2C1G3A4C4B6C2D1vdbhA-21D-17eukD1wzB1C-22j==',
        height: 240,
        language:'ko',
        fontFamily: {
          "'Nanum Gothic',sans-serif":'나눔고딕',
          "'Nanum Myeongjo',serif":'나눔명조',
          "'Sunflower',sans-serif":'Sunflower',
          "'Nanum Brush Script',cursive":'나눔 브러쉬 Script',
          "'Poor Story',cursive":'Poor Story',
          "'Nanum Pen Script',cursive":'나눔 펜 Script',
          "'Do Hyeon',sans-serif":'도현',
          "'Song Myung', serif":'Song Myung',
          "'Gothic A1', sans-serif":'Gothic A1',
          "'Black Han Sans', sans-serif":'Black Han Sans',
          "'Gamja Flower', cursive":'Gamja Flower'
        },
        fontFamilySelection: true,
        scaytAutoload : true
      });
      });
      $(document).ready(function(){

  /* 1. Visualizing things on Hover - See next part for action on click */
  $('#stars li').on('mouseover', function(){
    var onStar = parseInt($(this).data('value'), 10); // The star currently mouse on

    // Now highlight all the stars that's not after the current hovered star
    $(this).parent().children('li.star').each(function(e){
      if (e < onStar) {
        $(this).addClass('hover');
      }
      else {
        $(this).removeClass('hover');
      }
    });

  }).on('mouseout', function(){
    $(this).parent().children('li.star').each(function(e){
      $(this).removeClass('hover');
    });
  });


  /* 2. Action to perform on click */
  $('#stars li').on('click', function(){
    var onStar = parseInt($(this).data('value'), 10); // The star currently selected
    var stars = $(this).parent().children('li.star');

    for (i = 0; i < stars.length; i++) {
      $(stars[i]).removeClass('selected');
    }

    for (i = 0; i < onStar; i++) {
      $(stars[i]).addClass('selected');
    }

    // JUST RESPONSE (Not needed)
    var ratingValue = parseInt($('#stars li.selected').last().data('value'), 10);
    var msg;
    if (ratingValue >= 1) {
        msg = ratingValue;
    }
    responseMessage(msg);
  });
  function responseMessage(msg) {
    $('#rating_point').fadeIn(200);
    $('#rating_point').html(msg+'.0');
    $('#hidden_point').attr("value",(msg+'.0'));
    var temp = <%= temp%>;
    var review_average;
    if(<%- board.comments.length %> == 0){
      review_average = (msg+temp);
    }
    else{
      review_average = (msg+temp)/(<%= board.comments.length %>+1);
    }
    $('#reviewstar').attr("value",Math.round(review_average));
  }
});

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBR5TC1oRGXf90Q7CZck3R78M-APCvL0Qo&callback=myMap"></script>

<script src="plugins/jquery-ui/jquery-ui.min.js"></script>
<script src="plugins/tether/js/tether.min.js"></script>
<script src="plugins/raty/jquery.raty-fa.js"></script>
<script src="plugins/bootstrap/js/bootstrap.min.js"></script>
<script src="plugins/selectbox/jquery.selectbox-0.1.3.min.js"></script>
<script src="plugins/owl-carousel/owl.carousel.min.js"></script>
<script src="plugins/fancybox/jquery.fancybox.pack.js"></script>
<script src="plugins/smoothscroll/SmoothScroll.min.js"></script>
<script src="plugins/datepicker/bootstrap-datepicker.min.js"></script>
<script src="plugins/bootstrap-notify/bootstrap-notify.min.js"></script>
<script src="js/custom.js"></script>
    <script type="text/javascript">

    </script>
</body>

</html>
